### 求两直线公垂线问题

公垂线段的长度是两异面直线的最短距离，计算公式为：
$$
d = \frac{|(\vec{r}_{02} - \vec{r}_{01}) \cdot (\vec{d}_1 \times \vec{d}_2)|}{|\vec{d}_1 \times \vec{d}_2|}
$$

> 公垂线求法方法一

设两条异面直线分别为：
- 直线 $L_1$：$\vec{r}_1 = \vec{r}_{01} + t\vec{d}_1$，其中 $\vec{r}_{01}$ 是 $L_1$ 上一点，$\vec{d}_1$ 是方向向量。
- 直线 $L_2$：$\vec{r}_2 = \vec{r}_{02} + s\vec{d}_2$，其中 $\vec{r}_{02}$ 是 $L_2$ 上一点，$\vec{d}_2$ 是方向向量。

公垂线的方向向量 $\vec{d}$ 必须同时与 $\vec{d}_1$ 和 $\vec{d}_2$ 垂直，因此：
$$
\vec{d} = \vec{d}_1 \times \vec{d}_2
$$

公垂线是唯一一条与 $L_1$ 和 $L_2$ 都垂直的直线，其方程可以表示为：
$$
\vec{r} = \vec{r}_0 + k\vec{d}
$$
其中 $\vec{r}_0$ 是公垂线上的一点，$\vec{d}$ 是方向向量( $\vec{d} = \vec{d}_1 \times \vec{d}_2$ )。

##### Step1：确定公垂线的方向向量
计算 $\vec{d} = \vec{d}_1 \times \vec{d}_2$。
##### Step 2：确定公垂线的起点
公垂线的起点 $\vec{r}_0$ 是 $L_1$ 和 $L_2$ 上距离最近的两点 $P_1$ 和 $P_2$ 的中点。具体方法如下：
1. 设 $P_1$ 在 $L_1$ 上，$P_2$ 在 $L_2$ 上，则 $P_1$ 和 $P_2$ 满足：
   $$
   \vec{P_1} = \vec{r}_{01} + t\vec{d}_1
   $$$$
   \vec{P_2} = \vec{r}_{02} + s\vec{d}_2
   $$
2. 向量 $\vec{P_1P_2} = \vec{P_2} - \vec{P_1}$ 必须与 $\vec{d}_1$ 和 $\vec{d}_2$ 都垂直，因此：
   $$
   \vec{P_1P_2} \cdot \vec{d}_1 = 0
   $$
   $$
   \vec{P_1P_2} \cdot \vec{d}_2 = 0
   $$
3. 解上述方程组，求出参数 $t$ 和 $s$，从而确定 $P_1$ 和 $P_2$。
4. 公垂线的起点 $\vec{r}_0$ 是 $P_1$ 和 $P_2$ 的中点：
   $$
   \vec{r}_0 = \frac{\vec{P_1} + \vec{P_2}}{2}
   $$

##### Step3：写出公垂线的方程
根据 $\vec{r}_0$ 和 $\vec{d}$，公垂线的方程为：
$$
\vec{r} = \vec{r}_0 + k\vec{d}
$$

---
> 公垂线求法二

设两条异面直线分别为：
- 直线 $L_1$：$\vec{r}_1 = \vec{r}_{01} + t\vec{d}_1$，其中 $\vec{r}_{01}$ 是 $L_1$ 上一点，$\vec{d}_1$ 是方向向量。
- 直线 $L_2$：$\vec{r}_2 = \vec{r}_{02} + s\vec{d}_2$，其中 $\vec{r}_{02}$ 是 $L_2$ 上一点，$\vec{d}_2$ 是方向向量。

公垂线的方向向量 $\vec{d}$ 必须同时与 $\vec{d}_1$ 和 $\vec{d}_2$ 垂直，因此：
$$
\vec{d} = \vec{d}_1 \times \vec{d}_2
$$
**公垂线是：公垂线与 $L_1$ 形成的平面以及公垂线与 $L_2$ 形成的平面的交线。**

##### Step1：确定公垂线的方向向量
$$
\vec{d} = \vec{d}_1 \times \vec{d}_2
$$
##### Step2：求公垂线与 $L_1$ 、$L_2$ 形成的两平面 $\Pi_1$ 、 $\Pi_2$ 
$\Pi_1$ 的**法向量** $\vec{n_1}=(A_{1},B_1,C_1)$：
$$
\vec{n_1}=\vec{d} \times \vec{d}_1
$$

$\Pi_2$ 的**法向量** $\vec{n_2}=(A_{2},B_2,C_2)$：
$$
\vec{n_2}=\vec{d} \times \vec{d}_2
$$

于是有可以算的 $\Pi_1$ 、 $\Pi_2$ ：
$$
\Pi_1:A_1(x-x_{01})+B_1(y-y_{01})+C_1(z-z_{01})=0
$$
$$
\Pi_2:A_2(x-x_{02})+B_2(y-y_{02})+C_2(z-z_{02})=0
$$
其中 $\vec{r_{01}}=(x_{01},y_{01},z_{01})$ ， $\vec{r_{02}}=(x_{02},y_{02},z_{02})$

##### Step3：结论
于是，公垂线就是：
$$
\left\{\begin{matrix}
A_1(x-x_{01})+B_1(y-y_{01})+C_1(z-z_{01})=0
 \\
A_2(x-x_{02})+B_2(y-y_{02})+C_2(z-z_{02})=0
\end{matrix}\right.
$$
